# ------------------------------------------------ #
# Configuración de Servidor NO SEGURO (HTTP / WS)
# ------------------------------------------------ #
server {
    # Escucha en el puerto estándar NO SEGURO 80
    listen 80;
    server_name _; # O la IP interna de tu máquina local/Docker Compose network

    # ------------------------------------------------
    # Proxy para WebSockets (Websockify)
    # ------------------------------------------------
    location /websockify/ {
        # CRÍTICO: Aquí apunta a la IP/Nombre del servicio del Mini PC Simulado
        # Reemplaza 'minipc-websockify' con el nombre de tu servicio en el compose del Mini PC.
        proxy_pass http://10.13.13.2:6080/;
        # Asegúrate de que el puerto 6080 sea el que expone el servicio websockify

        # --- HEADERS OBLIGATORIOS PARA WEBSOCKETS ---
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        
        # Headers estándar
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        
        # Configuración para evitar desconexiones
        proxy_read_timeout 60s;
        proxy_send_timeout 60s;
        proxy_buffering off;
    }
    
    # ------------------------------------------------
    # Proxy para la API de Backend (Autenticación y Tokens)
    # ------------------------------------------------
    # location /api/ {
    #     # Reemplaza 'backend-api' con el nombre de tu servicio de Spring Boot
    #     proxy_pass http://backend-api:3000/api/; 
    #     # ... (Mantener headers estándar de proxy) ...
    # }

    # ------------------------------------------------
    # Proxy para el Frontend (React)
    # ------------------------------------------------
    # location / {
    #     # Reemplaza 'frontend-app' con el nombre de tu servicio de React
    #     proxy_pass http://frontend-app:80/; 
    # }
}